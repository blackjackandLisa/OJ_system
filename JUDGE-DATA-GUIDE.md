# åˆ¤é¢˜ç³»ç»Ÿæ•°æ®é…ç½®æŒ‡å—

## ğŸ“‹ é—®é¢˜è¯´æ˜

### é—®é¢˜1: é¢˜ç›®é¡µé¢çœ‹ä¸åˆ°æ ·ä¾‹è¾“å…¥è¾“å‡º

**åŸå› **: é¢˜ç›®ç¼ºå°‘**å…¬å¼€æ ·ä¾‹ï¼ˆProblemSampleï¼‰**

**è§£å†³**: ä¸ºé¢˜ç›®æ·»åŠ æ ·ä¾‹æ•°æ®

### é—®é¢˜2: åå°æ˜¾ç¤º"0ä¸ªåˆ¤é¢˜æœåŠ¡å™¨"

**è¯´æ˜**: å½“å‰æ¶æ„**ä¸éœ€è¦åˆ¤é¢˜æœåŠ¡å™¨ï¼ˆJudgeServerï¼‰æ¨¡å‹**

- å½“å‰åˆ¤é¢˜æ–¹å¼ï¼šç›´æ¥è°ƒç”¨Dockerå®¹å™¨æ‰§è¡Œåˆ¤é¢˜
- JudgeServeræ¨¡å‹æ˜¯ä¸ºæœªæ¥åˆ†å¸ƒå¼åˆ¤é¢˜æ¶æ„é¢„ç•™çš„
- ä¸å½±å“å½“å‰åˆ¤é¢˜åŠŸèƒ½

---

## ğŸ” æ•°æ®æ¨¡å‹è¯´æ˜

### 1. ProblemSampleï¼ˆé¢˜ç›®æ ·ä¾‹ï¼‰

**ç”¨é€”**: åœ¨é¢˜ç›®è¯¦æƒ…é¡µ**å…¬å¼€å±•ç¤º**ç»™ç”¨æˆ·çœ‹

**å­—æ®µ**:
- `input_data`: æ ·ä¾‹è¾“å…¥
- `output_data`: æ ·ä¾‹è¾“å‡º
- `explanation`: æ ·ä¾‹è¯´æ˜
- `order`: æ’åº

**ç¤ºä¾‹**:
```
æ ·ä¾‹1:
è¾“å…¥: 1 2
è¾“å‡º: 3
è¯´æ˜: 1 + 2 = 3
```

### 2. TestCaseï¼ˆæµ‹è¯•ç”¨ä¾‹ï¼‰

**ç”¨é€”**: åˆ¤é¢˜æ—¶ä½¿ç”¨ï¼Œ**ä¸å…¬å¼€**

**å­—æ®µ**:
- `input_data`: æµ‹è¯•è¾“å…¥
- `output_data`: æœŸæœ›è¾“å‡º
- `score`: åˆ†æ•°
- `order`: æ’åº

**ç¤ºä¾‹**:
```
æµ‹è¯•ç”¨ä¾‹1:
è¾“å…¥: 1 2\n
è¾“å‡º: 3\n
åˆ†æ•°: 10
```

### 3. JudgeServerï¼ˆåˆ¤é¢˜æœåŠ¡å™¨ï¼‰

**ç”¨é€”**: åˆ†å¸ƒå¼åˆ¤é¢˜æ¶æ„ï¼ˆå½“å‰æœªä½¿ç”¨ï¼‰

**å½“å‰æ¶æ„**: ç›´æ¥ä½¿ç”¨Dockerï¼Œæ— éœ€é…ç½®

---

## ğŸš€ å¿«é€Ÿä¿®å¤

### æ–¹æ³•1: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# åœ¨LinuxæœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /path/to/OJ_system

# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x fix-judge-data.sh

# è¿è¡Œè„šæœ¬
./fix-judge-data.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨**:
- âœ… æ£€æŸ¥A+B Problemæ˜¯å¦å­˜åœ¨
- âœ… åˆ›å»º2ä¸ªå…¬å¼€æ ·ä¾‹ï¼ˆå‰ç«¯æ˜¾ç¤ºï¼‰
- âœ… åˆ›å»º5ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆåˆ¤é¢˜ä½¿ç”¨ï¼‰
- âœ… æ˜¾ç¤ºæ•°æ®æ€»ç»“

### æ–¹æ³•2: æ‰‹åŠ¨æ·»åŠ ï¼ˆDjango Adminï¼‰

#### æ·»åŠ å…¬å¼€æ ·ä¾‹

1. è®¿é—® Django Admin:
   ```
   http://your-server-ip:8000/admin/
   ```

2. è¿›å…¥é¢˜ç›®ç®¡ç†:
   ```
   é¢˜ç›®ç®¡ç† â†’ é¢˜ç›® â†’ é€‰æ‹©é¢˜ç›®
   ```

3. æ»šåŠ¨åˆ°"é¢˜ç›®æ ·ä¾‹"åŒºåŸŸ

4. ç‚¹å‡»"æ·»åŠ å¦ä¸€ä¸ªé¢˜ç›®æ ·ä¾‹"

5. å¡«å†™æ ·ä¾‹æ•°æ®:
   ```
   æ ·ä¾‹1:
   è¾“å…¥æ•°æ®: 1 2
   è¾“å‡ºæ•°æ®: 3
   æ ·ä¾‹è¯´æ˜: 1 + 2 = 3
   æ’åº: 0
   
   æ ·ä¾‹2:
   è¾“å…¥æ•°æ®: 10 20
   è¾“å‡ºæ•°æ®: 30
   æ ·ä¾‹è¯´æ˜: 10 + 20 = 30
   æ’åº: 1
   ```

6. ä¿å­˜

#### æ·»åŠ æµ‹è¯•ç”¨ä¾‹

1. åœ¨é¢˜ç›®è¯¦æƒ…é¡µæ»šåŠ¨åˆ°"æµ‹è¯•ç”¨ä¾‹"åŒºåŸŸ

2. ç‚¹å‡»"æ·»åŠ å¦ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹"

3. å¡«å†™æµ‹è¯•ç”¨ä¾‹:
   ```
   æµ‹è¯•ç”¨ä¾‹1:
   è¾“å…¥æ•°æ®: 1 2
   (æ¢è¡Œ)
   è¾“å‡ºæ•°æ®: 3
   (æ¢è¡Œ)
   åˆ†æ•°: 10
   æ’åº: 0
   æ˜¯å¦ä¸ºæ ·ä¾‹: å¦
   
   æµ‹è¯•ç”¨ä¾‹2:
   è¾“å…¥æ•°æ®: 10 20
   (æ¢è¡Œ)
   è¾“å‡ºæ•°æ®: 30
   (æ¢è¡Œ)
   åˆ†æ•°: 10
   æ’åº: 1
   æ˜¯å¦ä¸ºæ ·ä¾‹: å¦
   
   ...ä»¥æ­¤ç±»æ¨
   ```

4. ä¿å­˜

### æ–¹æ³•3: ä½¿ç”¨Django Shell

```bash
python3 manage.py shell
```

æ‰§è¡Œä»¥ä¸‹ä»£ç :

```python
from apps.problems.models import Problem, ProblemSample, TestCase

# è·å–é¢˜ç›®
problem = Problem.objects.get(id=1)

# åˆ›å»ºå…¬å¼€æ ·ä¾‹
samples = [
    {'input': '1 2', 'output': '3', 'explanation': '1 + 2 = 3'},
    {'input': '10 20', 'output': '30', 'explanation': '10 + 20 = 30'}
]

for idx, sample in enumerate(samples):
    ProblemSample.objects.create(
        problem=problem,
        input_data=sample['input'],
        output_data=sample['output'],
        explanation=sample['explanation'],
        order=idx
    )

print(f"åˆ›å»ºäº† {len(samples)} ä¸ªå…¬å¼€æ ·ä¾‹")

# åˆ›å»ºæµ‹è¯•ç”¨ä¾‹
test_cases = [
    {'input': '1 2\n', 'output': '3\n'},
    {'input': '10 20\n', 'output': '30\n'},
    {'input': '-5 5\n', 'output': '0\n'},
    {'input': '100 200\n', 'output': '300\n'},
    {'input': '0 0\n', 'output': '0\n'},
]

for idx, tc in enumerate(test_cases):
    TestCase.objects.create(
        problem=problem,
        input_data=tc['input'],
        output_data=tc['output'],
        order=idx,
        score=10
    )

print(f"åˆ›å»ºäº† {len(test_cases)} ä¸ªæµ‹è¯•ç”¨ä¾‹")

exit()
```

---

## âœ… éªŒè¯ä¿®å¤ç»“æœ

### 1. æ£€æŸ¥æ•°æ®åº“

```bash
python3 manage.py shell -c "
from apps.problems.models import Problem
p = Problem.objects.get(id=1)
print(f'é¢˜ç›®: {p.title}')
print(f'å…¬å¼€æ ·ä¾‹: {p.samples.count()} ä¸ª')
print(f'æµ‹è¯•ç”¨ä¾‹: {p.test_cases.count()} ä¸ª')
"
```

**é¢„æœŸè¾“å‡º**:
```
é¢˜ç›®: A+B Problem
å…¬å¼€æ ·ä¾‹: 2 ä¸ª
æµ‹è¯•ç”¨ä¾‹: 5 ä¸ª
```

### 2. æ£€æŸ¥å‰ç«¯æ˜¾ç¤º

è®¿é—®é¢˜ç›®è¯¦æƒ…é¡µ:
```
http://your-server-ip:8000/problems/1/
```

**åº”è¯¥çœ‹åˆ°**:
- âœ… é¢˜ç›®æè¿°
- âœ… è¾“å…¥æ ¼å¼
- âœ… è¾“å‡ºæ ¼å¼
- âœ… **æ ·ä¾‹è¾“å…¥è¾“å‡º**ï¼ˆä¹‹å‰æ˜¯ç©ºçš„ï¼‰

### 3. æµ‹è¯•åˆ¤é¢˜åŠŸèƒ½

è®¿é—®æäº¤é¡µé¢:
```
http://your-server-ip:8000/problems/1/submit/
```

æäº¤æµ‹è¯•ä»£ç :
```python
a, b = map(int, input().split())
print(a + b)
```

**é¢„æœŸç»“æœ**: `AC (Accepted)` âœ…

---

## ğŸ”§ å…³äºåˆ¤é¢˜æœåŠ¡å™¨

### å½“å‰æ¶æ„ï¼ˆPhase 2ï¼‰

```
ç”¨æˆ·æäº¤ä»£ç 
    â†“
Django API
    â†“
åå°çº¿ç¨‹
    â†“
ç›´æ¥è°ƒç”¨ Docker å®¹å™¨åˆ¤é¢˜
    â†“
è¿”å›ç»“æœ
```

**ä¸éœ€è¦**é…ç½® JudgeServer æ¨¡å‹ã€‚

### æœªæ¥æ¶æ„ï¼ˆPhase 3ï¼‰

å¦‚æœéœ€è¦åˆ†å¸ƒå¼åˆ¤é¢˜ï¼ˆå¤šå°åˆ¤é¢˜æœåŠ¡å™¨ï¼‰ï¼Œæ‰éœ€è¦é…ç½® JudgeServerï¼š

```
ç”¨æˆ·æäº¤ä»£ç 
    â†“
Django API
    â†“
Celery å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—
    â†“
è´Ÿè½½å‡è¡¡é€‰æ‹©åˆ¤é¢˜æœåŠ¡å™¨
    â†“
è¿œç¨‹åˆ¤é¢˜æœåŠ¡å™¨æ‰§è¡Œ
    â†“
è¿”å›ç»“æœ
```

**å±Šæ—¶é…ç½®æ–¹æ³•**:

```python
# åœ¨Django Shellä¸­
from apps.judge.models import JudgeServer

JudgeServer.objects.create(
    hostname='judge-server-1',
    ip_address='192.168.1.100',
    port=8080,
    is_active=True,
    max_tasks=10
)
```

ä½†**ç›®å‰ä¸éœ€è¦**ã€‚

---

## ğŸ“š å¸¸è§é—®é¢˜

### Q1: å…¬å¼€æ ·ä¾‹å’Œæµ‹è¯•ç”¨ä¾‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

| é¡¹ç›® | å…¬å¼€æ ·ä¾‹ | æµ‹è¯•ç”¨ä¾‹ |
|------|---------|---------|
| **ç”¨é€”** | å±•ç¤ºç»™ç”¨æˆ· | åˆ¤é¢˜ä½¿ç”¨ |
| **æ˜¯å¦å…¬å¼€** | æ˜¯ | å¦ |
| **æ•°é‡** | 1-3ä¸ª | å¤šä¸ª |
| **æ˜¾ç¤ºä½ç½®** | é¢˜ç›®è¯¦æƒ…é¡µ | ä¸æ˜¾ç¤º |

### Q2: ä¸ºä»€ä¹ˆæäº¤ä¸€ç›´"ç­‰å¾…ä¸­"ï¼Ÿ

å¯èƒ½åŸå› ï¼š
1. âŒ æµ‹è¯•ç”¨ä¾‹æœªåˆ›å»º â†’ è¿è¡Œä¿®å¤è„šæœ¬
2. âŒ Dockeræœªå¯åŠ¨ â†’ `sudo systemctl start docker`
3. âŒ åˆ¤é¢˜é•œåƒæœªæ„å»º â†’ é‡æ–°æ„å»ºé•œåƒ
4. âŒ docker-pyæœªå®‰è£… â†’ `pip3 install docker==7.0.0`

è¯¦è§: `JUDGE-TROUBLESHOOTING.md`

### Q3: å¦‚ä½•åˆ›å»ºæ–°é¢˜ç›®ï¼Ÿ

1. **åœ¨Django Adminåˆ›å»ºé¢˜ç›®**:
   - å¡«å†™åŸºæœ¬ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€æè¿°ç­‰ï¼‰
   - ä¿å­˜

2. **æ·»åŠ å…¬å¼€æ ·ä¾‹**:
   - åœ¨é¢˜ç›®è¯¦æƒ…é¡µæ·»åŠ 2-3ä¸ªæ ·ä¾‹

3. **æ·»åŠ æµ‹è¯•ç”¨ä¾‹**:
   - æ·»åŠ 5-10ä¸ªæµ‹è¯•ç”¨ä¾‹
   - è®¾ç½®åˆ†æ•°ï¼ˆé€šå¸¸æ¯ä¸ª10åˆ†ï¼‰

4. **å‘å¸ƒé¢˜ç›®**:
   - çŠ¶æ€æ”¹ä¸º"å·²å‘å¸ƒ"

### Q4: æµ‹è¯•ç”¨ä¾‹éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ

âš ï¸ **é‡è¦**:
- è¾“å…¥è¾“å‡º**å¿…é¡»åŒ…å«æ¢è¡Œç¬¦** `\n`
- ä¾‹å¦‚: `'1 2\n'` è€Œä¸æ˜¯ `'1 2'`
- è¾“å‡ºä¹Ÿè¦æœ‰æ¢è¡Œ: `'3\n'` è€Œä¸æ˜¯ `'3'`

**æ­£ç¡®ç¤ºä¾‹**:
```python
TestCase.objects.create(
    problem=problem,
    input_data='1 2\n',    # âœ“ æ­£ç¡®ï¼šæœ‰æ¢è¡Œ
    output_data='3\n',     # âœ“ æ­£ç¡®ï¼šæœ‰æ¢è¡Œ
    score=10
)
```

**é”™è¯¯ç¤ºä¾‹**:
```python
TestCase.objects.create(
    problem=problem,
    input_data='1 2',      # âœ— é”™è¯¯ï¼šç¼ºå°‘æ¢è¡Œ
    output_data='3',       # âœ— é”™è¯¯ï¼šç¼ºå°‘æ¢è¡Œ
    score=10
)
```

---

## ğŸ¯ æ€»ç»“

**ä¿®å¤æ­¥éª¤**:

1. âœ… è¿è¡Œä¿®å¤è„šæœ¬: `./fix-judge-data.sh`
2. âœ… éªŒè¯æ•°æ®: æ£€æŸ¥æ ·ä¾‹å’Œæµ‹è¯•ç”¨ä¾‹
3. âœ… æµ‹è¯•åˆ¤é¢˜: æäº¤ä»£ç éªŒè¯åŠŸèƒ½
4. âœ… å¿½ç•¥"0ä¸ªåˆ¤é¢˜æœåŠ¡å™¨"æç¤ºï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰

**å…³é”®ç‚¹**:
- å…¬å¼€æ ·ä¾‹ â‰  æµ‹è¯•ç”¨ä¾‹
- å½“å‰ä¸éœ€è¦é…ç½®åˆ¤é¢˜æœåŠ¡å™¨
- æµ‹è¯•ç”¨ä¾‹è¾“å…¥è¾“å‡ºè¦æœ‰æ¢è¡Œç¬¦

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2024-10-02

